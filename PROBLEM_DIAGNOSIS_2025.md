# 🚨 2025 백테스트 저조한 수익률 원인 분석

## 📊 성능 비교 요약

| 지표 | 2023-2024 | 2025 | 차이 |
|------|-----------|------|------|
| **수익률** | **250.50%** | **6.90%** | **36배 차이** ❌ |
| Sharpe Ratio | 6.842 | 1.611 | 4.2배 하락 |
| Max Drawdown | 0.65% | 5.14% | 7.9배 악화 |
| Win Rate | 55.10% | 41.29% | -13.81%p |
| Profit Factor | 2.61 | 1.04 | 2.5배 하락 |
| 총 거래 수 | 2,441 (2년) | 1,889 (11개월) | 비슷 |

---

## 🔍 근본 원인: 시장 환경 변화 (Domain Shift)

### 1️⃣ **가격대 불일치** (가장 심각)

```
학습 데이터 (2019-2022): 평균 $26,688
테스트 2023-2024 ✅:     평균 $43,731 (+64%)
테스트 2025 ❌:         평균 $85,260 (+219%)
```

**문제점**:
- 모델이 $26,688 중심으로 학습했는데, 2025년엔 $85,260에서 거래
- **3배 이상 높은 가격대**에서 동일한 패턴 인식 실패
- 절대값 기반 지표(ATR, Bollinger Band 등)가 무용지물

### 2️⃣ **변동성 구조 변화**

```
학습 데이터 (2019-2022): 359.84% (극도로 높음, 코로나 포함)
테스트 2023-2024 ✅:     127.78% (안정기)
테스트 2025 ❌:         167.31% (중간 수준)
```

**왜 2023-2024는 잘 작동했나?**
- 2019-2022 학습 구간이 **극단적 변동성(코로나, 강세장, 약세장)** 포함
- 다양한 시장 상황 학습 → 2023-2024의 상대적으로 안정적인 환경에서 잘 작동

**왜 2025는 안 되나?**
- 2025는 변동성이 중간 수준이지만 **가격대가 너무 다름**
- 특히 **급격한 움직임 비율**이 학습 구간과 다름:
  - 학습: 33.85%
  - 2023-2024: 9.94% (훨씬 적음) ← 모델이 이런 환경에 적응
  - 2025: 11.72% (조금 더 많음) ← 미세한 차이가 성능 하락 유발

### 3️⃣ **트렌드 방향 차이**

```
학습 구간:    +287.53% (강한 상승)
2023-2024:    +75.60% (상승)
2025:         -19.24% (하락 전환!) ⚠️
```

**문제점**:
- 모델이 **상승장에 최적화**되어 있음
- 2025년은 **하락 전환 구간** (100K → 80K대로 조정)
- 롱 포지션 위주 전략이 먹히지 않음

---

## 📉 실제 거래 결과 분석

### 승률 급락의 의미

- **2023-2024**: 55.10% 승률 → 신호 정확도 높음
- **2025**: 41.29% 승률 → **거의 랜덤에 가까움** (50% 기준)

### Profit Factor 붕괴

```
Profit Factor = 총 이익 / 총 손실

2023-2024: 2.61 (이익이 손실의 2.61배)
2025:      1.04 (겨우 손익분기)
```

**의미**:
- 승리해도 큰 수익 못 냄
- 손실은 제대로 발생
- 리스크 대비 보상 비율 붕괴

---

## 💡 해결 방안

### 🎯 즉시 적용 가능한 솔루션

#### 1. **가격 정규화 (Price Normalization)** ⭐ 최우선
```python
# 절대 가격 대신 수익률 기반으로 변환
df['returns'] = df['close'].pct_change()
df['norm_close'] = df['close'] / df['close'].rolling(100).mean()
```

**효과**: 가격대 차이를 완전히 제거

#### 2. **학습 데이터 업데이트** ⭐ 필수
```
현재: 2019-2022 (4년 전 데이터)
변경: 2021-2024 (최신 2년 포함)
```

**효과**:
- 최신 시장 환경 학습
- $40,000+ 가격대 경험 반영

#### 3. **Triple Barrier 파라미터 조정**
```
현재: Profit Target 1.5%, Stop Loss 0.5%
변경: 시장 변동성에 따라 동적 조정

예시:
- 변동성 낮을 때: PT 1.0%, SL 0.3%
- 변동성 높을 때: PT 2.5%, SL 0.8%
```

#### 4. **Confidence Threshold 최적화**
```
현재: 50% (고정)
변경: 동적 조정

- 상승장: 50%
- 하락장: 60% (더 확실한 신호만)
- 횡보장: 55%
```

---

### 🔬 중장기 개선 방안

#### 5. **Ensemble 가중치 동적 조정**
- XGBoost, TabNet, CatBoost의 가중치를 시장 상황에 따라 변경
- 현재는 단순 평균 (1/3씩)

#### 6. **시장 체제 분류 (Market Regime Detection)**
```python
# 강세/약세/횡보 구간 자동 감지
regime = detect_market_regime(df)

if regime == "BULL":
    use_aggressive_strategy()
elif regime == "BEAR":
    use_defensive_strategy()
else:
    use_neutral_strategy()
```

#### 7. **Walk-Forward Optimization**
- 3개월마다 모델 재학습
- 최신 6개월 데이터로 지속적 업데이트

---

## 🎬 즉시 실행할 액션 플랜

### Phase 1: 긴급 수정 (30분)
1. ✅ 가격 정규화 적용
2. ✅ 학습 데이터를 2021-2024로 변경
3. ✅ 재학습 및 2025 백테스트

### Phase 2: 파라미터 튜닝 (1시간)
4. Confidence threshold를 50% → 60%로 상향
5. Triple Barrier를 변동성 기반으로 조정

### Phase 3: 검증 (30분)
6. 결과 비교 및 리포트

---

## 📌 예상 개선 효과

### 현실적인 목표
```
현재 2025 성능:   6.90% 수익
목표 (Phase 1):   40-60% 수익
목표 (Phase 2):   80-120% 수익
최종 목표:       150-200% 수익 (2023-2024의 60-80% 수준)
```

**왜 250%는 어려운가?**
- 2025년은 **하락장 포함** (-19.24%)
- 2023-2024는 **상승장만** (+75.60%)
- 구조적으로 더 어려운 환경

---

## ✅ 결론

**문제**: 모델이 2019-2022 저가/고변동성 환경에 과적합
**해결**: 가격 정규화 + 최신 데이터 학습 + 동적 파라미터 조정

**지금 바로 시작하시겠습니까?** 🚀
